#!/usr/bin/env python3
"""
User Prompt Submit Hook - Brief acknowledgment when user sends message

Gives quick audio feedback that the message was received.
"""

import sys
import json
import subprocess
import os
from pathlib import Path
import random

# Brief acknowledgments (vary to keep it natural)
ACKNOWLEDGMENTS = [
    "Got it.",
    "Understood.",
    "Let me help with that.",
    "On it.",
    "Sure.",
]

def main():
    try:
        # Read prompt data
        data = json.loads(sys.stdin.read())

        # Get the user's message
        message = data.get('text', '')

        # Only acknowledge non-empty, substantial messages
        if not message or len(message) < 3:
            return

        # Check if it's a voice command (starts with "Claude")
        # If so, don't double-acknowledge (command parser will respond)
        if message.lower().strip().startswith('claude'):
            return

        # Pick a random brief acknowledgment
        ack = random.choice(ACKNOWLEDGMENTS)

        # Get path to TTS script
        script_dir = Path(__file__).parent
        tts_script = script_dir / 'elevenlabs_tts.py'

        # Call TTS with silent mode
        env = os.environ.copy()
        env['TTS_SILENT_MODE'] = 'true'

        subprocess.run(
            [str(tts_script), ack],
            env=env,
            stdout=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL
        )

    except Exception as e:
        # Silently fail
        pass

if __name__ == '__main__':
    main()
