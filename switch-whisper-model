#!/home/badong/Projects/learning-dsa/whisper-env/bin/python3
"""
Switch Whisper Model

Easily change between different Whisper models for accuracy vs speed trade-off.

Usage:
    ./switch-whisper-model tiny
    ./switch-whisper-model base
    ./switch-whisper-model small
    ./switch-whisper-model medium
    ./switch-whisper-model large-v3
    ./switch-whisper-model large-v3-turbo
    ./switch-whisper-model turbo
"""

import sys
import json
from pathlib import Path

CONFIG_FILE = Path(__file__).parent / ".claude/hooks/utils/voice_config.json"

MODELS = {
    "tiny": {"size": "39MB", "wer": "32%", "speed": "Fastest"},
    "tiny.en": {"size": "39MB", "wer": "32%", "speed": "Fastest"},
    "base": {"size": "74MB", "wer": "16%", "speed": "Fast"},
    "base.en": {"size": "74MB", "wer": "16%", "speed": "Fast"},
    "small": {"size": "244MB", "wer": "10%", "speed": "Medium"},
    "small.en": {"size": "244MB", "wer": "10%", "speed": "Medium"},
    "medium": {"size": "769MB", "wer": "8%", "speed": "Slow"},
    "medium.en": {"size": "769MB", "wer": "8%", "speed": "Slow"},
    "large-v3": {"size": "1550MB", "wer": "5%", "speed": "Slowest"},
    "large-v3-turbo": {"size": "809MB", "wer": "5%", "speed": "Fast (optimized)"},
    "turbo": {"size": "809MB", "wer": "8%", "speed": "Very Fast"},
}

def show_models():
    """Show available models"""
    print("Available Whisper Models:")
    print("=" * 60)
    print(f"{'Model':<20} {'Size':<10} {'Accuracy':<10} {'Speed':<20}")
    print("-" * 60)

    for model, info in MODELS.items():
        print(f"{model:<20} {info['size']:<10} {info['wer']:<10} {info['speed']:<20}")

    print("=" * 60)
    print("\nRecommended:")
    print("  large-v3-turbo - Best accuracy + GPU optimized (with your RTX 4070!)")
    print("  turbo          - Very fast + good accuracy")
    print("  medium         - Good balance")
    print("")
    print("Usage: ./switch-whisper-model <model_name>")

def switch_model(model_name):
    """Switch to specified model"""
    if model_name not in MODELS:
        print(f"❌ Unknown model: {model_name}")
        print("")
        show_models()
        return 1

    # Load config
    with open(CONFIG_FILE) as f:
        config = json.load(f)

    # Update model
    old_model = config.get('whisper_model', 'unknown')
    config['whisper_model'] = model_name

    # Save config
    with open(CONFIG_FILE, 'w') as f:
        json.dump(config, f, indent=2)

    info = MODELS[model_name]
    print(f"✅ Switched from '{old_model}' to '{model_name}'")
    print(f"   Size: {info['size']} | Accuracy: {info['wer']} WER | Speed: {info['speed']}")
    print("")
    print("Next voice detection will use this model.")
    print("Note: First use will download the model (~" + info['size'] + ")")
    print("")
    print("Test it: ./test-voice")

    return 0

def main():
    if len(sys.argv) < 2:
        show_models()
        return 1

    model_name = sys.argv[1].lower()

    if model_name in ['list', 'show', 'help']:
        show_models()
        return 0

    return switch_model(model_name)

if __name__ == '__main__':
    sys.exit(main())
